(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};m=function(a,b){var c,d,e,f,g,h,i,j,k;if(null==a)return ko.observable(b);switch(a.type){case"string":case"number":case"integer":case"boolean":return ko.observable(b);case"object":if(null==b)return ko.observable(b);if(null!=a.properties){j=a.properties;for(e in j)f=j[e],g=b[e],null==g&&null!=(null!=f?f.type:void 0)&&("array"!==(k=f.type)&&"object"!==k||(g=f["default"])),b[e]=m(f,g)}return ko.observable(b);case"array":if(null==b)return ko.observableArray(b);for(d=h=0,i=b.length;i>h;d=++h)c=b[d],b[d]=m(a.items,b[d]);return ko.observableArray(b);default:return ko.observable(b)}},k=function(a){var b,c,d,e,f,g,h,i;if(a=ko.unwrap(a),null==a)return a;switch(g=a,f=Array.isArray(a)?"array":typeof a){case"object":g={};for(d in a)e=a[d],g[d]=k(e);break;case"array":for(g=[],c=h=0,i=a.length;i>h;c=++h)b=a[c],g[c]=k(b)}return g},i=function(a){return"string"==typeof a&&0===a.length||isNaN(a)},l=function(a,b,c,d){var e,f,g,h,j,k,m,n,o,p,q,r;if(null!=b)switch(a.type){case"string":break;case"boolean":break;case"object":if(a.properties&&null!=a.properties){m=a.properties,q=[];for(g in m)h=m[g],null!=h.definedBy&&(e=b[h.definedBy],null!=e&&e in h.options&&(h=h.options[e])),j=b[g],null==j||"number"!==(n=h.type)&&"integer"!==n||(i(j)?c.push(""+g+" must be a number"):b[g]=parseFloat(j)),q.push(l(h,j,c,b));return q}break;case"array":if(null!=a.items){for(r=[],f=k=0,o=b.length;o>=0?o>k:k>o;f=o>=0?++k:--k)j=b[f],null==j||"number"!==(p=a.items.type)&&"integer"!==p||(i(j)?c.push(""+g+" must be a number"):b[f]=parseFloat(j)),r.push(l(a.items,j,c,b));return r}}},e=function(a){var b;if(null!=a.defaut)return a["default"];if((null!=(b=a["enum"])?b.length:void 0)>0)return a["enum"][0];switch(a.type){case"string":return"";case"number":case"integer":return"";case"boolean":return!1;case"object":return{};case"array":return[]}},h=function(a){var b,c,d,f,g,h,i,j;if(null==a.schema.properties)return[];f=ko.unwrap(a.value),null==f&&(f={},a.value(f)),i=[],j=a.schema.properties;for(d in j)g=j[d],h=k(f[d]),null!=g.definedBy&&(c=ko.unwrap(f[g.definedBy]),null!=c&&c in g.options&&(b=g,b.definedByValue=b.definedByValue||c,g=g.options[c],b.values=b.values||{},b.values[b.definedByValue]=h,b.definedByValue=c,h=b.values[c])),null==h&&null!=a.schema.required&&n.call(a.schema.required,d)>=0&&(h=e(g)),f[d]=m(g,h),i.push({schema:g,value:f[d]});return i},g=function(a){var b;return null==ko.unwrap(a)?[]:function(){var c,d,e,f;for(e=ko.unwrap(a),f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push({schema:this.items||{},value:b});return f}.call(this)},j=function(a,b){return b.schema.editingItem({schema:b.schema,value:m(b.schema,k(b.value)),index:a})},c=function(a,b){var c,d;return d=b.schema.editingItem(),null!=d.index?(c=a.value(),c[d.index](d.value()),a.value(c)):a.value.push(d.value),b.schema.editingItem(null)},b=function(a){return a.schema.editingItem(null)},a=function(a){var b;b=null!=a.schema.items["default"]?m(a.schema.items,JSON.parse(JSON.stringify(a.schema.items["default"]))):m(a.schema.items,e(a.schema.items)),a.schema.items.editingItem({schema:a.schema.items,value:b})},f=function(a){var b,c;return c=k(a),"object"===this.type&&null!=this.properties?(b="",null!=this.properties.name&&(b=c.name),null!=this.properties.id&&(b.length>0?b+=" ("+c.id+")":b=c.id),null!=b&&b.length>0?b:JSON.stringify(c)):""+c},d=function(i,k){var l,m,o,p,q,r,s,t,u,v;switch(i.name=k,i.notDefault=function(a){return function(a){return ko.pureComputed({read:function(){return null!=("function"==typeof a.value?a.value():void 0)},write:function(b){var c;return b?(c=a.schema["default"],null==c&&(c=e(a.schema)),a.value(c)):a.value(void 0)}})}}(this),i.enabled=function(a){return function(a){return null!=("function"==typeof a.value?a.value():void 0)}}(this),i.valueOrDefault=function(a){return function(a){return ko.pureComputed({read:function(){return null!=("function"==typeof a.value?a.value():void 0)?a.value():a.schema["default"]},write:function(b){return a.value(b)}})}}(this),i.type){case"object":if(i.getProperties=h,null!=i.properties){i.hasProperties=Object.keys(i.properties).length>0,s=i.properties;for(k in s)if(r=s[k],null!=i.required&&(r.notRequired=!(n.call(i.required,k)>=0)),d(r,k),null!=(null!=(t=r.defines)?t.property:void 0)){l=i.properties[r.defines.property],l.options=r.defines.options,l.definedBy=k,u=l.options;for(p in u)q=u[p],d(q,r.defines.property)}}else i.hasProperties=!1;break;case"array":i.getItems=g,null==i.items&&(i.items={}),i.items.getItemLabel=f,i.items.onEditItemClick=j,i.items.editOk=c,i.items.editCancel=b,i.items.addItem=a,i.items.editingItem=ko.observable(null),i.items.isSorting=ko.observable(!1),i.items.onSorted=function(a){return function(a){return function(b,c,d){var e,f,g,h,i,j;for(g=0,h=0,e=a.value(),b=b.value(),c=null!=c?c.value():null,d=null!=d?d.value():null,f=i=0,j=e.length;j>=0?j>i:i>j;f=j>=0?++i:--i)e[f]()===b&&(g=f),e[f]()===d&&(h=f-1);return null==c&&(h=0),null==d&&(h=e.length-1),g!==h?(e.splice(g,1),e.splice(h,0,ko.observable(b)),a.value(e)):void 0}}}(this),i.items.onRemove=function(a){return function(a){return function(b){var c,d,e,f;for(c=a.value(),b=b.value(),d=e=0,f=c.length;f>=0?f>e:e>f;d=f>=0?++e:--e)if(c[d]()===b)return c.splice(d,1),void a.value(c)}}}(this),m=i.items.name||""+k+" Item",null!=k&&null!=(o=k.match(/^(.+)s/))&&(m=o[1]),d(i.items,m);break;case"string":case"number":case"integer":case"boolean":null!=(null!=(v=i.defines)?v.options:void 0)&&null==i["enum"]&&(i["enum"]=Object.keys(i.defines.options))}},window.jsonschemaeditor={wrap:m,unwrap:k,enhanceSchema:d,validate:l}}).call(this);