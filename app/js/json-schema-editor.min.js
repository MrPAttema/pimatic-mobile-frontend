(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};p=function(a,b){var c,d,e,f,g,h,i,j,k;if(null==a)return ko.observable(b);switch(a.type){case"string":case"number":case"integer":case"boolean":return ko.observable(b);case"object":if(null==b)return ko.observable(b);if(null!=a.properties){j=a.properties;for(e in j)f=j[e],g=b[e],null==g&&null!=(null!=f?f.type:void 0)&&("array"!==(k=f.type)&&"object"!==k||(g=f["default"])),b[e]=p(f,g)}return ko.observable(b);case"array":if(null==b)return ko.observableArray(b);for(d=h=0,i=b.length;i>h;d=++h)c=b[d],b[d]=p(a.items,b[d]);return ko.observableArray(b);default:return ko.observable(b)}},n=function(a){var b,c,d,e,f,g,h,i;if(a=ko.unwrap(a),null==a)return a;switch(g=a,f=Array.isArray(a)?"array":typeof a){case"object":g={};for(d in a)e=a[d],g[d]=n(e);break;case"array":for(g=[],c=h=0,i=a.length;i>h;c=++h)b=a[c],g[c]=n(b)}return g},k=function(a){return"string"==typeof a&&0===a.length||isNaN(a)},o=function(a,b,c,d){var e,f,g,h,i,j,l,m,n,p,q,r;if(null!=b)switch(a.type){case"string":break;case"boolean":break;case"object":if(a.properties&&null!=a.properties){l=a.properties,q=[];for(g in l)h=l[g],null!=h.definedBy&&(e=b[h.definedBy],null!=e&&e in h.options&&(h=h.options[e])),i=b[g],null==i||"number"!==(m=h.type)&&"integer"!==m||(k(i)?c.push(""+g+" must be a number"):b[g]=parseFloat(i)),q.push(o(h,i,c,b));return q}break;case"array":if(null!=a.items){for(r=[],f=j=0,n=b.length;n>=0?n>j:j>n;f=n>=0?++j:--j)i=b[f],null==i||"number"!==(p=a.items.type)&&"integer"!==p||(k(i)?c.push(""+g+" must be a number"):b[f]=parseFloat(i)),r.push(o(a.items,i,c,b));return r}}},f=function(a){var b;if(null!=a.defaut)return a["default"];if((null!=(b=a["enum"])?b.length:void 0)>0)return a["enum"][0];switch(a.type){case"string":return"";case"number":case"integer":return"";case"boolean":return!1;case"object":return{};case"array":return[]}},j=function(a){var b,c,d,e,g,h,i,j;if(null==a.schema.properties)return[];e=ko.unwrap(a.value),null==e&&(e={},a.value(e)),i=[],j=a.schema.properties;for(d in j)g=j[d],h=n(e[d]),null!=g.definedBy&&(c=ko.unwrap(e[g.definedBy]),null!=c&&c in g.options&&(b=g,b.definedByValue=b.definedByValue||c,g=g.options[c],b.values=b.values||{},b.values[b.definedByValue]=h,b.definedByValue=c,h=b.values[c])),null==h&&null!=a.schema.required&&q.call(a.schema.required,d)>=0&&(h=f(g)),e[d]=p(g,h),i.push({schema:g,value:e[d]});return i},g=function(a){var b,c,d,f,g,h,i,j,k;if(null==a.schema.extraProperties)return[];g=ko.unwrap(a.value),null==g&&(g={},a.value(g)),b=a.schema.extraProperties(),c=!1;for(d in g)k=g[d],d in b||d in(a.schema.properties||{})||(k=n(k),"undefined"!=typeof k&&(f={type:typeof k,isExtra:!0},e(f,d),b[d]=f,c=!0));c&&a.schema.extraProperties(b),j=[];for(d in b)h=b[d],i=n(g[d]),g[d]=p(h,i),j.push({schema:h,value:g[d],parent:a});return j},i=function(a){var b;return null==ko.unwrap(a)?[]:function(){var c,d,e,f;for(e=ko.unwrap(a),f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push({schema:this.items||{},value:b});return f}.call(this)},l=function(a,b){return b.schema.editingItem({schema:b.schema,value:p(b.schema,n(b.value)),index:a})},d=function(a,b){var c,d;return d=b.schema.editingItem(),null!=d.index?(c=a.value(),c[d.index](d.value()),a.value(c)):a.value.push(d.value),b.schema.editingItem(null)},c=function(a){return a.schema.editingItem(null)},a=function(a){var b;b=null!=a.schema.items["default"]?p(a.schema.items,JSON.parse(JSON.stringify(a.schema.items["default"]))):p(a.schema.items,f(a.schema.items)),a.schema.items.editingItem({schema:a.schema.items,value:b})},b=function(a){var b,c,d,g,h;return c=a.schema.newPropertyName(),0===c.length?void alert("Name can not be empty"):(h=a.schema.newPropertyType(),g={type:h,isExtra:!0},e(g,c),d=a.value(),d[c]=f(g),a.value(d),b=a.schema.extraProperties(),b[c]=g,a.schema.extraProperties(b),a.schema.newPropertyName(""),a.schema.newPropertyType("string"))},m=function(a){var b,c,d;return c=a.schema.name,d=n(a.parent.value),delete d[c],b=a.parent.schema.extraProperties(),delete b[c],a.parent.value(d),a.parent.schema.extraProperties(b)},h=function(a){var b,c;return c=n(a),"object"===this.type&&null!=this.properties?(b="",null!=this.nameProperty&&null!=c[this.nameProperty]?b=c[this.nameProperty]:null!=this.properties.name?b=c.name:null!=this.properties.id&&(b.length>0?b+=" ("+c.id+")":b=c.id),null!=b&&b.length>0?b:JSON.stringify(c)):""+c},e=function(k,n){var o,p,r,s,t,u,v,w,x,y;switch(k.name=n,k.notDefault=function(a){return function(a){return ko.pureComputed({read:function(){return null!=("function"==typeof a.value?a.value():void 0)},write:function(b){var c;return b?(c=a.schema["default"],null==c&&(c=f(a.schema)),a.value(c)):a.value(void 0)}})}}(this),k.enabled=function(a){return function(a){return null!=("function"==typeof a.value?a.value():void 0)}}(this),k.valueOrDefault=function(a){return function(a){return ko.pureComputed({read:function(){return null!=("function"==typeof a.value?a.value():void 0)?a.value():a.schema["default"]},write:function(b){return a.value(b)}})}}(this),k.type){case"object":if(k.getProperties=j,k.allowAdditionalProperties=null==k.properties||"object"==typeof k.additionalProperties,k.allowAdditionalProperties&&(k.newPropertyName=ko.observable(""),k.newPropertyType=ko.observable("string"),"object"==typeof k.additionalProperties&&null!=k.additionalProperties.type?(k.extraPropertiesDescription=k.additionalProperties.description,k.newPropertyTypes=[k.additionalProperties.type]):k.newPropertyTypes=["string","number","boolean","object"],k.newPropertyAdd=b,k.extraProperties=ko.observable({}),k.getExtraProperties=g,k.removeExtraProperty=m),null!=k.properties){k.hasProperties=Object.keys(k.properties).length>0,v=k.properties;for(n in v)if(u=v[n],null!=k.required&&(u.notRequired=!(q.call(k.required,n)>=0)),e(u,n),null!=(null!=(w=u.defines)?w.property:void 0)){o=k.properties[u.defines.property],o.options=u.defines.options,o.definedBy=n,x=o.options;for(s in x)t=x[s],e(t,u.defines.property)}}else k.hasProperties=!1;break;case"array":k.getItems=i,null==k.items&&(k.items={}),k.items.getItemLabel=h,k.items.onEditItemClick=l,k.items.editOk=d,k.items.editCancel=c,k.items.addItem=a,k.items.editingItem=ko.observable(null),k.items.isSorting=ko.observable(!1),k.items.onSorted=function(a){return function(a){return function(b,c,d){var e,f,g,h,i,j;for(g=0,h=0,e=a.value(),b=b.value(),c=null!=c?c.value():null,d=null!=d?d.value():null,f=i=0,j=e.length;j>=0?j>i:i>j;f=j>=0?++i:--i)e[f]()===b&&(g=f),e[f]()===d&&(h=f-1);return null==c&&(h=0),null==d&&(h=e.length-1),g!==h?(e.splice(g,1),e.splice(h,0,ko.observable(b)),a.value(e)):void 0}}}(this),k.items.onRemove=function(a){return function(a){return function(b){var c,d,e,f;for(c=a.value(),b=b.value(),d=e=0,f=c.length;f>=0?f>e:e>f;d=f>=0?++e:--e)if(c[d]()===b)return c.splice(d,1),void a.value(c)}}}(this),p=k.items.name||""+n+" Item",null!=n&&null!=(r=n.match(/^(.+)s/))&&(p=r[1]),e(k.items,p);break;case"string":case"number":case"integer":case"boolean":null!=(null!=(y=k.defines)?y.options:void 0)&&null==k["enum"]&&(k["enum"]=Object.keys(k.defines.options))}},window.jsonschemaeditor={wrap:p,unwrap:n,enhanceSchema:e,validate:o}}).call(this);