!function(a){a.widget("mobile.timebox",{options:{dmin:!1,dmax:!1,step:!1,theme:!1,mini:null,repButton:!0,version:"0.1-2016-08-08",initSelector:"input[data-role='timebox']",clickEvent:"vclick",type:"horizontal"},_sbox_run:function(){var a=this,b=150;a.g.cnt>10&&(b=100),a.g.cnt>30&&(b=50),a.g.cnt>60&&(b=20),a.g.didRun=!0,a._offset(this,a.g.delta),a.g.cnt++,a.runButton=setTimeout(function(){a._sbox_run()},b)},_offset:function(a,b){var c,d,e,f,g,h,i,j,k,l,m=this,n=this.options;if(e=m.d.input.val(),/^([01]?[0-9]|2[0-3]):[0-5][0-9]/.test(e)&&(f=parseInt(e.substring(0,e.indexOf(":"))),g=parseInt(e.substring(e.indexOf(":")+1)),h=parseInt(n.dmin.substring(0,e.indexOf(":"))),i=parseInt(n.dmin.substring(e.indexOf(":")+1)),j=parseInt(n.dmax.substring(0,e.indexOf(":"))),k=parseInt(n.dmax.substring(e.indexOf(":")+1)),l=!0,!m.disabled)){if(d=f,1>b){for(c=g-n.step;0>c;)c+=60,d-=1;0>d&&(d+=24),60*h+i>60*d+c&&(l=!1)}else{for(c=g+n.step;c>59;)c-=60,d+=1;d>23&&(d-=24),60*d+c>60*j+k&&(l=!1)}l===!0&&(10>c&&(c="0"+String(c)),10>d&&(d="0"+String(d)),m.d.input.val(String(d)+":"+String(c)).trigger("change"))}},_create:function(){var b=this,c=a.extend(this.options,this.element.data("options")),d={input:this.element,inputWrap:this.element.parent()},e="undefined"!=typeof window.ontouchstart,f={eStart:(e?"touchstart":"mousedown")+".timebox",eMove:(e?"touchmove":"mousemove")+".timebox",eEnd:(e?"touchend":"mouseup")+".timebox",eEndA:e?"mouseup.timebox touchend.timebox touchcancel.timebox touchmove.timebox":"mouseup.timebox mouseleave.timebox",move:!1,start:!1,end:!1,pos:!1,target:!1,delta:!1,tmp:!1,cnt:0};b.d=d,b.g=f,c.theme=c.theme===!1?a.mobile.getInheritedTheme(this.element,"a"):c.theme,b.d.input.prop("disabled")&&(c.disabled=!0),c.dmin===!1&&(c.dmin=/([01]?[0-9]|2[0-3]):[0-5][0-9]/.test(b.d.input.attr("min"))===!0?b.d.input.attr("min"):"00:00"),c.dmax===!1&&(c.dmax=/([01]?[0-9]|2[0-3]):[0-5][0-9]/.test(b.d.input.attr("max"))===!0?b.d.input.attr("max"):"23:59"),c.step===!1&&(c.step="undefined"!=typeof b.d.input.attr("step")?parseFloat(b.d.input.attr("step")):15),c.mini=null===c.mini?!!b.d.input.data("mini"):c.mini,b.d.wrap=a("<div>",{"data-role":"controlgroup","data-type":c.type,"data-mini":c.mini,"data-theme":c.theme}).insertBefore(b.d.inputWrap).append(b.d.inputWrap),b.d.inputWrap.addClass("ui-btn"),b.d.input.css({textAlign:"center"}),"vertical"!==c.type||(b.d.wrap.css({width:"auto"}),b.d.inputWrap.css({padding:0})),b.d.up=a("<div>",{"class":"ui-btn ui-icon-plus ui-btn-icon-notext"}).html("&nbsp;"),b.d.down=a("<div>",{"class":"ui-btn ui-icon-minus ui-btn-icon-notext"}).html("&nbsp;"),"vertical"!==c.type?b.d.wrap.prepend(b.d.down).append(b.d.up):b.d.wrap.prepend(b.d.up).append(b.d.down),b.d.wrap.controlgroup(),c.repButton===!1?(b.d.up.on(c.clickEvent,function(a){a.preventDefault(),b._offset(a.currentTarget,1)}),b.d.down.on(c.clickEvent,function(a){a.preventDefault(),b._offset(a.currentTarget,-1)})):(b.d.up.on(b.g.eStart,function(a){b.d.input.blur(),b._offset(a.currentTarget,1),b.g.move=!0,b.g.cnt=0,b.g.delta=1,b.runButton||(b.g.target=a.currentTarget,b.runButton=setTimeout(function(){b._sbox_run()},500))}),b.d.down.on(b.g.eStart,function(a){b.d.input.blur(),b._offset(a.currentTarget,-1),b.g.move=!0,b.g.cnt=0,b.g.delta=-1,b.runButton||(b.g.target=a.currentTarget,b.runButton=setTimeout(function(){b._sbox_run()},500))}),b.d.up.on(b.g.eEndA,function(a){b.g.move&&(a.preventDefault(),clearTimeout(b.runButton),b.runButton=!1,b.g.move=!1)}),b.d.down.on(b.g.eEndA,function(a){b.g.move&&(a.preventDefault(),clearTimeout(b.runButton),b.runButton=!1,b.g.move=!1)})),"undefined"!=typeof a.event.special.mousewheel&&b.d.input.on("mousewheel",function(a,c){a.preventDefault(),b._offset(a.currentTarget,0>c?-1:1)}),c.disabled&&b.disable()},disable:function(){var a=this.d,b="ui-state-disabled";a.input.attr("disabled",!0).blur(),a.inputWrap.addClass(b),a.up.addClass(b),a.down.addClass(b),this.options.disabled=!0},enable:function(){var a=this.d,b="ui-state-disabled";a.input.attr("disabled",!1),a.inputWrap.removeClass(b),a.up.removeClass(b),a.down.removeClass(b),this.options.disabled=!1}})}(jQuery);