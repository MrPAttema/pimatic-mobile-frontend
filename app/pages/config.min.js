(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=Array.prototype.concat,LazyLoad.js(a.apply(scripts.editor)),LazyLoad.css(a.apply(styles.editor)),$(document).on("pagecreate","#config-page",function(){var a,c,d;a=function(){function a(){this.updateConfigClicked=b(this.updateConfigClicked,this);var a,c,d;d=this,a=$("#config-editor")[0],c=JSONEditor.prototype.setMode,JSONEditor.prototype.setMode=function(a){var b;return b=c.call(this,a),d.mode(a),b},ko.computed(function(a){return function(){var b,c,d,e,f,g;return b=a.mode(),"code"===b&&(null!=(c=a.editor)&&c.editor.setReadOnly(a.locked()),a.locked()?$("#config-editor .ace_content").addClass("readonly"):$("#config-editor .ace_content").removeClass("readonly")),"view"===b&&(null!=(d=a.editor)&&(d.modes=["tree","code"]),a.locked()||null!=(e=a.editor)&&e.setMode("tree")),"tree"===b&&(null!=(f=a.editor)&&(f.modes=["view","code"]),a.locked())&&null!=(g=a.editor)?g.setMode("view"):void 0}}(this)),this.editor=new JSONEditor(a,{mode:"view",modes:["view","code"]}),this.getConfig(),this.config.subscribe(function(a){return function(b){return a.editor.set(b)}}(this)),this.lockButton=ko.computed(function(a){return function(){var b;return b=a.locked(),{icon:b?"gear":"delete",text:__(b?"Edit":"Cancel")}}}(this)),$.mobile.document.on("pagebeforechange",function(a){return function(b,c){var d;return(null!=(d=c.options.fromPage)?d.is("#config-page"):void 0)&&!a.locked()?(swal({title:"Discard all changes?",text:"If you leave the page all unsaved changes will be lost, continue?",type:"warning",showCancelButton:!0,confirmButtonText:"Continue",closeOnConfirm:!0},function(){return a.locked(!0),$.mobile.pageContainer.pagecontainer("change",c.toPage,{options:c.options})}),b.preventDefault(),!1):!0}}(this))}return a.prototype.config=ko.observable(""),a.prototype.mode=ko.observable(""),a.prototype.locked=ko.observable(!0),a.prototype.toggleLock=function(){return this.locked()?swal({type:"prompt",title:"Unlock",text:"Please Enter your password to unlock the config page:",promptPlaceholder:"Password",promptDefaultValue:"",promptInputType:"password"},function(a){return function(b){return pimatic.client.rest.getConfig({password:b}).done(function(b){a.config(b.config),a.locked(!1)}).fail(ajaxAlertFail)}}(this)):pimatic.client.rest.getConfig({}).done(function(a){return function(b){a.config(b.config),a.locked(!0)}}(this)).fail(ajaxAlertFail)},a.prototype.getConfig=function(){return pimatic.client.rest.getConfig({}).done(function(a){return function(b){a.config(b.config)}}(this)).fail(ajaxAlertFail)},a.prototype.updateConfigClicked=function(){return swal({title:"Are you sure?",text:"pimatic will be restarted after the config was changed!",type:"warning",showCancelButton:!0,confirmButtonText:"Yes",closeOnConfirm:!1},function(a){return function(){var b,c;try{return b=a.editor.get(),pimatic.client.rest.updateConfig({config:b}).done(function(){return swal("Restarting","Config seems to be valid, restarting...","success"),a.locked(!0)}).fail(ajaxAlertFail).fail()}catch(d){return c=d,swal("Oops...",c,"error")}}}(this))},a}();try{pimatic.pages.config=c=new a,ko.applyBindings(c,$("#config-page")[0])}catch(e){d=e,TraceKit.report(d)}}),$(document).on("pagehide","#config-page",function(){var a,b;try{if(a=pimatic.pages.config,null!=a.editor)return a.config(null)}catch(c){return b=c,TraceKit.report(b)}}),$(document).on("pageshow","#config-page",function(){var a,b;try{if(a=pimatic.pages.config,null!=a.editor&&null==a.config())return a.getConfig()}catch(c){return b=c,TraceKit.report(b)}})}).call(this);