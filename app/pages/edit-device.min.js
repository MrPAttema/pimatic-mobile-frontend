(function(){var a,b=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=Array.prototype.concat,LazyLoad.js(a.apply(scripts.jsonschemaeditor)),$(document).on("pagebeforecreate","#edit-device-page",function(){var a,b;if(null==pimatic.pages.editDevice){a=function(){function a(){this.pageTitle=ko.computed(function(a){return function(){return __("add"===a.action()?"Add New Device":"Edit Device")}}(this)),pimatic.autoFillId(this.deviceName,this.deviceId,this.action),this.deviceClass.subscribe(function(a){return function(b){return null!=b&&"string"==typeof b&&b.length>0?pimatic.client.rest.getDeviceConfigSchema({className:b}).done(function(b){var c,d,e;return null!=b.success?(d=b.configSchema,delete d.properties.id,delete d.properties.name,delete d.properties["class"],e=jsonschemaeditor.unwrap(a.deviceConfig()),c=jsonschemaeditor.wrap(d,e),a.deviceConfig(c()),jsonschemaeditor.enhanceSchema(d,null),a.configSchema(d)):void 0}):a.configSchema(null)}}(this))}return a.prototype.action=ko.observable("add"),a.prototype.deviceName=ko.observable(""),a.prototype.deviceId=ko.observable(""),a.prototype.deviceClass=ko.observable(""),a.prototype.deviceClasses=ko.observableArray(),a.prototype.deviceConfig=ko.observable({}),a.prototype.configSchema=ko.observable(null),a.prototype.editor=null,a.prototype.afterRenderItem=function(a){var b;return b=$("#sortable-handle-template").text(),$(a).find("a").before($(b))},a.prototype.resetFields=function(){return this.deviceName(""),this.deviceId(""),this.deviceConfig({}),this.deviceClass("")},a.prototype.onSubmit=function(){var a;return a=jsonschemaeditor.unwrap(this.deviceConfig()),a.id=this.deviceId(),a.name=this.deviceName(),a["class"]=this.deviceClass(),function(){switch(this.action()){case"add":return pimatic.client.rest.addDeviceByConfig({deviceConfig:a});case"update":return pimatic.client.rest.updateDeviceByConfig({deviceConfig:a});default:throw new Error("Illegal devicedevice action: "+action())}}.call(this).done(function(a){return a.success?$.mobile.changePage("#devices-page",{transition:"slide",reverse:!0}):alert(a.error)}).fail(ajaxAlertFail),!1},a.prototype.onRemove=function(){var a;return a=confirm(__("Do you really want to delete the %s device?",this.deviceName())),a&&pimatic.client.rest.removeDevice({deviceId:this.deviceId()}).done(function(a){return a.success?$.mobile.changePage("#devices-page",{transition:"slide",reverse:!0}):alert(a.error)}).fail(ajaxAlertFail),!1},a}();try{pimatic.pages.editDevice=new a}catch(c){b=c,TraceKit.report(b)}}}),$(document).on("pagebeforeshow","#edit-device-page",function(){return pimatic.client.rest.getDeviceClasses({}).done(function(){return function(a){var b;return a.success?(b=[""].concat(a.deviceClasses),pimatic.pages.editDevice.deviceClasses(b)):void 0}}(this))}),$(document).on("pagecreate","#edit-device-page",function(){var a;try{return ko.applyBindings(pimatic.pages.editDevice,$("#edit-device-page")[0])}catch(b){return a=b,TraceKit.report(a)}}),$(document).on("pagebeforeshow","#edit-device-page",function(){var a,c,d,e,f;d=pimatic.pages.editDevice,e=jQuery.mobile.pageParams,jQuery.mobile.pageParams={},"update"===(null!=e?e.action:void 0)?(a=e.device,d.action("update"),d.deviceId(a.id),d.deviceName(a.name()),d.deviceClass(null),d.configSchema(null),d.deviceConfig(a.config),c=pimatic.pages.editDevice.deviceClasses(),f=a.config["class"],b.call(c,f)<0&&(c.push(a.config["class"]),d.deviceClasses(c)),d.deviceClass(a.config["class"])):(d.resetFields(),d.action("add"))})}).call(this);