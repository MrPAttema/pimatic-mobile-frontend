(function(){$(document).on("pageinit","#plugins-page",function(){return pimatic.client.rest.getInstalledPluginsWithInfo().done(function(a){var b,c,d,e;for(console.log(a),$("#plugin-list").empty(),pimatic.pages.plugins.installedPlugins=a.plugins,e=a.plugins,c=0,d=e.length;d>c;c++)b=e[c],pimatic.pages.plugins.addPlugin(b);return $("#plugin-list").listview("refresh"),$("#plugin-list input[type='checkbox']").checkboxradio()}).fail(ajaxAlertFail),$("#plugins-page").on("click","#plugin-do-action",function(){var a,b,c,d,e,f;if(c=$("#select-plugin-action").val(),"select"===c)return alert(__("Please select a action first"));for(b=[],f=$('#plugin-list input[type="checkbox"]'),d=0,e=f.length;e>d;d++)a=f[d],a=$(a),a.is(":checked")&&b.push(a.data("plugin-name"));return function(){switch(c){case"add":return pimatic.client.rest.addPluginsToConfig({pluginNames:b});case"remove":return pimatic.client.rest.removePluginsFromConfig({pluginNames:b})}}().done(function(a){var b;b="add"===c?"added":"removed",pimatic.showToast(a[b].length+__(" plugins "+b)+"."+(a[b].length>0?" "+__("Please restart pimatic."):"")),pimatic.pages.plugins.uncheckAllPlugins()}).fail(ajaxAlertFail)}),$("#plugins-page").on("click",".restart-now",function(){return pimatic.client.rest.restart({}).fail(ajaxAlertFail)})}),$(document).on("pagebeforeshow","#plugins-page",function(){return pimatic["try"](function(){return function(){return $("#select-plugin-action").val("select").selectmenu("refresh")}}(this))}),$(document).on("pageinit","#plugins-browse",function(){return pimatic.showToast(__("pimatic is searching for plugins for you...")),pimatic.client.rest.searchForPluginsWithInfo().done(function(a){var b,c,d,e;for($("#plugin-browse-list").empty(),pimatic.pages.plugins.allPlugins=a.plugins,e=a.plugins,c=0,d=e.length;d>c;c++)b=e[c],pimatic.pages.plugins.addBrowsePlugin(b),b.isNewer&&$("#plugin-"+b.name+" .update-available").show(),$("#plugin-browse-list").listview("refresh");return pimatic.pages.plugins.disableInstallButtons()}).fail(ajaxAlertFail),$("#plugin-browse-list").on("click",".add-to-config",function(){var a,b;a=$(this).parent("li"),b=a.data("plugin"),pimatic.client.rest.addPluginsToConfig({pluginNames:[b.name]}).done(function(c){var d;d=null,c.added.length>0?(d=__("Added %s to the config. Plugin will be auto installed on next start.",b.name),d+=" "+__("Please restart pimatic."),a.find(".add-to-config").addClass("ui-disabled")):d=__("The plugin %s was already in the config.",b.name),pimatic.showToast(d)}).fail(ajaxAlertFail)})}),pimatic.pages.plugins={installedPlugins:null,allPlugins:null,uncheckAllPlugins:function(){var a,b,c,d;for(d=$('#plugin-list input[type="checkbox"]'),b=0,c=d.length;c>b;b++)a=d[b],$(a).prop("checked",!1).checkboxradio("refresh")},addPlugin:function(a){var b,c,d;c="plugin-"+a.name,d=$($("#plugin-template").html()),d.attr("id",c),b="cb-"+c,d.find(".name").text(a.name),d.find(".description").text(a.description),d.find(".version").text(a.version),d.find(".homepage").text(a.homepage).attr("href",a.homepage),a.active?d.find(".active").show():d.find(".active").hide(),d.find(".update-available").hide(),d.find("input[type='checkbox']").attr("id",b).attr("name",b).data("plugin-name",a.name),$("#plugin-list").append(d)},disableInstallButtons:function(){var a,b,c,d;if(null!=pimatic.pages.plugins.allPlugins)for(d=pimatic.pages.plugins.allPlugins,b=0,c=d.length;c>b;b++)a=d[b],a.installed&&$("#plugin-browse-list #plugin-browse-"+a.name+" .add-to-config").addClass("ui-disabled")},addBrowsePlugin:function(a){var b,c;b="plugin-browse-"+a.name,c=$($("#plugin-browse-template").html()),c.data("plugin",a),c.attr("id",b),c.find(".name").text(a.name),c.find(".description").text(a.description),c.find(".version").text(a.version),a.active?c.find(".active").show():c.find(".active").hide(),a.installed?c.find(".installed").show():c.find(".installed").hide(),$("#plugin-browse-list").append(c)}}}).call(this);