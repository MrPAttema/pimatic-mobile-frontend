(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=pimatic.tryCatch,$(document).on("pagebeforecreate","#plugins-page",function(c){var d,e;if(null==pimatic.pages.plugins){d=function(){function c(){this.onInstallClick=b(this.onInstallClick,this),this.onSettingsClick=b(this.onSettingsClick,this),this.onUninstallClick=b(this.onUninstallClick,this),this.onDeactivateClick=b(this.onDeactivateClick,this),this.onActivateClick=b(this.onActivateClick,this);var c;this.hasPermission=pimatic.hasPermission,this.updateProcessStatus=pimatic.updateProcessStatus,this.updateFromJs({installedPlugins:[],browsePlugins:[]}),this.updateListView=ko.computed(a(function(a){return function(){return a.installedPlugins(),pimatic["try"](function(){return $("#plugin-list").listview("refresh")})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),c=this.updateProcessStatus(),this.updateProcessStatus.subscribe(function(a){return function(b){return"running"===c&&(b="done")&&a.refresh(),c=b}}(this))}return c.mapping={$default:"ignore",installedPlugins:{$key:"name",$itemOptions:{$default:"copy",loaded:"observe",activated:"observe"}},browsePlugins:{$key:"name",$itemOptions:{$default:"copy",installed:"observe",loaded:"observe",activated:"observe"}}},c.prototype.restartRequired=ko.observable(!1),c.prototype.updateFromJs=function(a){return ko.mapper.fromJS(a,c.mapping,this)},c.prototype.onActivateClick=function(a){return pimatic.client.rest.getPluginConfig({pluginName:a.name}).done(function(b){return function(c){return null!=c.success?(b.restartRequired(!0),null==c.config?(jQuery.mobile.pageParams={action:"add",pluginName:a.name},jQuery.mobile.changePage("#edit-plugin-page")):pimatic.client.rest.setPluginActivated({pluginName:a.name,active:!0}).done(function(b){return b.success?a.activated(!0):void 0})):void 0}}(this)),!1},c.prototype.onDeactivateClick=function(a){return pimatic.client.rest.setPluginActivated({pluginName:a.name,active:!1}).done(function(b){return function(c){return c.success?(a.activated(!1),b.restartRequired(!0)):void 0}}(this)).fail(ajaxAlertFail)},c.prototype.onUninstallClick=function(a){var b;return b=confirm(__("Do you really want to uninstall the %s plugin?",a.name)),b?pimatic.client.rest.uninstallPlugin({name:"pimatic-"+a.name}).done(function(b){return function(){var c;return b.restartRequired(!0),b.refresh(),c=confirm(__("Do you want to remove all config options as well?")),c?pimatic.client.rest.removePluginFromConfig({pluginName:a.name}).done(function(){return b.refresh()}).fail(ajaxAlertFail):pimatic.client.rest.setPluginActivated({pluginName:a.name,active:!1}).done(function(){return b.refresh()}).fail(ajaxAlertFail)}}(this)).fail(ajaxAlertFail):void 0},c.prototype.onSettingsClick=function(a){return jQuery.mobile.pageParams={action:"update",pluginName:a.name},!0},c.prototype.onInstallClick=function(a){var b;return b=["pimatic-"+a.name],pimatic.client.rest.installUpdatesAsync({modules:b}).fail(function(a){return function(a,b,c){return"timeout"!==b?ajaxAlertFail(a,b,c):void 0}}(this))},c.prototype.getInstalledPluginsWithInfo=function(){return pimatic.client.rest.getInstalledPluginsWithInfo().done(function(a){return function(b){return a.updateFromJs({installedPlugins:b.plugins})}}(this)).fail(ajaxAlertFail)},c.prototype.searchForPluginsWithInfo=function(){return pimatic.client.rest.searchForPluginsWithInfo().done(function(a){return function(b){return a.updateFromJs({browsePlugins:b.plugins})}}(this)).fail(ajaxAlertFail)},c.prototype.refresh=function(){return this.getInstalledPluginsWithInfo(),this.searchForPluginsWithInfo()},c}();try{pimatic.pages.plugins=new d}catch(f){e=f,TraceKit.report(e)}}}),$(document).on("pagecreate","#plugins-page",function(a){var b;try{ko.applyBindings(pimatic.pages.plugins,$("#plugins-page")[0])}catch(c){b=c,TraceKit.report(b)}return $("#plugins-page").on("click",".restart-now",function(a,b){return pimatic.client.rest.restart({}).fail(ajaxAlertFail)})}),$(document).on("pageinit","#plugins-page",function(a){var b;return b=pimatic.pages.plugins,b.refresh()})}).call(this);