(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=pimatic.tryCatch,$(document).on("pagebeforecreate","#groups-page",a(function(c){var d,e;return d=function(){function c(){this.onEditGroupClicked=b(this.onEditGroupClicked,this),this.onGroupsSorted=b(this.onGroupsSorted,this),this.groups=pimatic.groups,this.hasPermission=pimatic.hasPermission,this.groupsListViewRefresh=ko.computed(a(function(a){return function(){return a.groups(),a.isSortingGroups(),a.enabledEditing(),pimatic["try"](function(){return $("#groups").listview("refresh").addClass("dark-background")})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.lockButton=ko.computed(a(function(a){return function(){var b;return b=a.enabledEditing(),{icon:b?"check":"gear"}}}(this)))}return c.prototype.enabledEditing=ko.observable(!0),c.prototype.isSortingGroups=ko.observable(!1),c.prototype.afterRenderGroup=function(a,b){var c;return c=$("#sortable-handle-template").text(),$(a).find("a").before($(c))},c.prototype.toggleEditing=function(){return this.enabledEditing(!this.enabledEditing())},c.prototype.onGroupsSorted=function(a,b,c){var d,e,f,g,h;for(e=[],null==b&&e.push(a.id),h=this.groups(),f=0,g=h.length;g>f;f++)d=h[f],d!==a&&(e.push(d.id),null!=b&&d===b&&e.push(a.id));return pimatic.client.rest.updateGroupOrder({groupOrder:e}).done(ajaxShowToast).fail(ajaxAlertFail)},c.prototype.onDropGroupOnTrash=function(a){var b,c;return c=confirm(__("Do you really want to delete the %s group?",a.name())),c?(b=function(b){return function(){return pimatic.loading("deletegroup","show",{text:__("Saving")}),pimatic.client.rest.removeGroup({groupId:a.id}).always(function(){return pimatic.loading("deletegroup","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this))():void 0},c.prototype.onAddGroupClicked=function(){return jQuery.mobile.pageParams={action:"add"},!0},c.prototype.onEditGroupClicked=function(a){return this.hasPermission("groups","write")||pimatic.isDemo()?(jQuery.mobile.pageParams={action:"update",group:a},!0):(pimatic.showToast(__("Sorry, you have no permissions to edit this group.")),!1)},c}(),pimatic.pages.groups=e=new d})),$(document).on("pagecreate","#groups-page",a(function(a){var b,c,d;c=pimatic.pages.groups;try{ko.applyBindings(c,$("#groups-page")[0])}catch(e){b=e,TraceKit.report(b),null!=(d=pimatic.storage)&&d.removeAll(),window.location.reload()}$("#groups .handle").disableSelection()})),$(document).on("pagebeforeshow","#groups-page",a(function(a){return pimatic["try"](function(a){return function(){return $("#groups").listview("refresh").addClass("dark-background")}}(this))}))}).call(this);