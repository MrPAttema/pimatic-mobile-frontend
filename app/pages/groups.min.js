(function(){var a,b=function(a,b){return function(){return a.apply(b,arguments)}};a=pimatic.tryCatch,$(document).on("pagebeforecreate","#groups-page",a(function(){var c,d;return c=function(){function c(){this.onEditGroupClicked=b(this.onEditGroupClicked,this),this.onGroupsSorted=b(this.onGroupsSorted,this),this.groups=pimatic.groups,this.hasPermission=pimatic.hasPermission,this.groupsListViewRefresh=ko.computed(a(function(a){return function(){return a.groups(),a.isSortingGroups(),a.enabledEditing(),pimatic["try"](function(){return $("#groups").listview("refresh").addClass("dark-background")})}}(this))).extend({rateLimit:{timeout:1,method:"notifyWhenChangesStop"}}),this.lockButton=ko.computed(a(function(a){return function(){var b;return b=a.enabledEditing(),{icon:b?"check":"gear"}}}(this)))}return c.prototype.enabledEditing=ko.observable(!0),c.prototype.isSortingGroups=ko.observable(!1),c.prototype.afterRenderGroup=function(a){var b;return b=$("#sortable-handle-template").text(),$(a).find("a").before($(b))},c.prototype.toggleEditing=function(){return this.enabledEditing(!this.enabledEditing())},c.prototype.onGroupsSorted=function(a,b){var c,d,e,f,g;for(d=[],null==b&&d.push(a.id),g=this.groups(),e=0,f=g.length;f>e;e++)c=g[e],c!==a&&(d.push(c.id),null!=b&&c===b&&d.push(a.id));return pimatic.client.rest.updateGroupOrder({groupOrder:d}).done(ajaxShowToast).fail(ajaxAlertFail)},c.prototype.onDropGroupOnTrash=function(a){var b,c;return c=confirm(__("Do you really want to delete the %s group?",a.name())),c?(b=function(){return function(){return pimatic.loading("deletegroup","show",{text:__("Saving")}),pimatic.client.rest.removeGroup({groupId:a.id}).always(function(){return pimatic.loading("deletegroup","hide")}).done(ajaxShowToast).fail(ajaxAlertFail)}}(this))():void 0},c.prototype.onAddGroupClicked=function(){return jQuery.mobile.pageParams={action:"add"},!0},c.prototype.onEditGroupClicked=function(a){return this.hasPermission("groups","write")||pimatic.isDemo()?(jQuery.mobile.pageParams={action:"update",group:a},!0):(pimatic.showToast(__("Sorry, you have no permissions to edit this group.")),!1)},c}(),pimatic.pages.groups=d=new c})),$(document).on("pagecreate","#groups-page",a(function(){var a,b,c;b=pimatic.pages.groups;try{ko.applyBindings(b,$("#groups-page")[0])}catch(d){a=d,TraceKit.report(a),null!=(c=pimatic.storage)&&c.removeAll(),window.location.reload()}$("#groups .handle").disableSelection()})),$(document).on("pagebeforeshow","#groups-page",a(function(){return pimatic["try"](function(){return function(){return $("#groups").listview("refresh").addClass("dark-background")}}(this))}))}).call(this);