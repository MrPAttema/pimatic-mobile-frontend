(function(){var a={}.hasOwnProperty,b=function(b,c){function d(){this.constructor=b}for(var e in c)a.call(c,e)&&(b[e]=c[e]);return d.prototype=c.prototype,b.prototype=new d,b.__super__=c.prototype,b},c=function(a,b){return function(){return a.apply(b,arguments)}};$(document).on("pagebeforecreate",function(a){var d,e,f,g,h,i,j,k,l,m,n,o,p,q,r;null==pimatic.templateClasses&&(r=$("#sortable-handle-template").text(),j=function(){function a(a){this.templData=a,ko.mapper.fromJS(this.templData,this.constructor.mapping,this)}return a.prototype.update=function(a){return this.templData=a,ko.mapper.fromJS(this.templData,this.constructor.mapping,this)},a.prototype.afterRender=function(a){return $(a).addClass("item").find("label").before($(r))},a}(),h=function(a){function c(a){var b,c,d,e;if(0===a.length)this.title="Ungrouped";else for(this.title="",c=d=0,e=a.length;e>d;c=++d)b=a[c],0!==c&&(this.title+=", "),this.title+=b.name()}return b(c,a),c.prototype.afterRender=function(){},c.prototype.getItemTemplate=function(){return"header"},c}(j),f=function(a){function d(a,b){this.device=b,this.labelTooltipHtml=c(this.labelTooltipHtml,this),d.__super__.constructor.call(this,a),this.name=this.device.name,this.deviceId=a.deviceId}return b(d,a),d.mapping={$default:"ignore",deviceId:"copy"},d.prototype.getAttribute=function(a){return this.device.getAttribute(a)},d.prototype.getItemTemplate=function(){return this.device.template},d.prototype.afterAttributeRender=function(a,b){var c;return c=$(a),c.addClass("attr-"+b.name).addClass("attr-type-"+b.type),c.parent(".attributes").addClass("contains-attr-"+b.name).addClass("contains-attr-type-"+b.type)},d.prototype.error=function(){return this.device===pimatic.nullDevice?"Could not find a device with id: "+this.templData.deviceId:null},d.prototype.toJS=function(){return ko.mapper.toJS(this,this.constructor.mapping)},d.prototype.labelTooltipHtml=function(){var a,b;return b="<div>ID: "+this.deviceId+"</div>\n<div>Class: "+this.device.config["class"]+"</div>",a=[],this.device.config.xLink&&a.push('<a href="'+this.device.config.xLink+'" target="_blank">Link</a>'),this.device.hasAttibuteWith(function(a){return function(a){var b;return"number"===(b=a.type)||"boolean"===b}}(this))&&a.push('  \n<a href="#" id="to-graph-page"\ndata-deviceId="'+this.device.id+'">Graph</a>'),a.length>0&&(b+="<div>"+a.join("")+"</div>"),b},d.prototype.getConfig=function(a){return null!=this.device.config[a]?this.device.config[a]:this.device.configDefaults[a]},d}(j),n=function(a){function c(a,b){var d;if(this.device=b,c.__super__.constructor.call(this,a,this.device),this.switchId="switch-"+a.deviceId,d=this.getAttribute("state"),null==d)throw new Error("A switch device needs an state attribute!");this.switchState=ko.observable(d.value()?"on":"off"),d.value.subscribe(function(a){return function(b){return a._restoringState=!0,a.switchState(b?"on":"off"),pimatic["try"](function(){return a.sliderEle.flipswitch("refresh")}),a._restoringState=!1}}(this))}return b(c,a),c.prototype.onSwitchChange=function(){var a,b,c,d,e;if(!this._restoringState&&(d="on"===this.switchState(),e=this.getAttribute("state").value(),d!==e))return this.sliderEle.flipswitch("disable"),a="on"===this.switchState()?"turnOn":"turnOff",b=this.device.config.xConfirm?confirm(__("Do you really want to turn %s "+this.switchState()+"? ",this.device.name())):!0,c="on"===this.switchState()?"off":"on",b?(pimatic.loading("switch-on-"+this.switchId,"show",{text:__("switching "+this.switchState())}),this.device.rest[a]({},{global:!1}).done(ajaxShowToast).fail(function(a){return function(){return a._restoringState=!0,a.switchState(c),pimatic["try"](function(){return a.sliderEle.flipswitch("refresh")}),a._restoringState=!1}}(this)).always(function(a){return function(){return pimatic.loading("switch-on-"+a.switchId,"hide"),pimatic["try"](function(){return a.sliderEle.flipswitch("enable")})}}(this)).fail(ajaxAlertFail)):(this._restoringState=!0,this.switchState(c),pimatic["try"](function(a){return function(){return a.sliderEle.flipswitch("enable")}}(this)),pimatic["try"](function(a){return function(){return a.sliderEle.flipswitch("refresh")}}(this)),this._restoringState=!1)},c.prototype.afterRender=function(a){var b,d;return c.__super__.afterRender.call(this,a),this.sliderEle=$(a).find("select"),d=this.getAttribute("state"),null!=d.labels&&(b=function(a){return a.charAt(0).toUpperCase()+a.slice(1)},this.sliderEle.find("option[value=on]").text(b(d.labels[0])),this.sliderEle.find("option[value=off]").text(b(d.labels[1]))),this.sliderEle.flipswitch(),$(a).find(".ui-flipswitch").addClass("no-carousel-slide")},c}(f),g=function(a){function c(a,b){var d,e;if(this.device=b,c.__super__.constructor.call(this,a,this.device),this.sliderId="switch-"+a.deviceId,d=this.getAttribute("dimlevel"),null==d)throw new Error("A dimmer device needs an dimlevel attribute!");e=d.value,this.sliderValue=ko.observable(null!=e()?e():0),d.value.subscribe(function(a){return function(b){return a.sliderValue(b),pimatic["try"](function(){return a.sliderEle.slider("refresh")})}}(this))}return b(c,a),c.prototype.onSliderStop=function(){return this.sliderEle.slider("disable"),pimatic.loading("dimming-"+this.sliderId,"show",{text:__("dimming to %s%",this.sliderValue())}),this.device.rest.changeDimlevelTo({dimlevel:this.sliderValue()},{global:!1}).done(ajaxShowToast).fail(function(a){return function(){return pimatic["try"](function(){return a.sliderEle.val(a.getAttribute("dimlevel").value()).slider("refresh")})}}(this)).always(function(a){return function(){return pimatic.loading("dimming-"+a.sliderId,"hide"),pimatic["try"](function(){return a.sliderEle.slider("enable")})}}(this)).fail(ajaxAlertFail)},c.prototype.afterRender=function(a){return c.__super__.afterRender.call(this,a),this.sliderEle=$(a).find("input"),this.sliderEle.slider(),$(a).find(".ui-slider").addClass("no-carousel-slide")},c}(f),o=function(a){function d(){return this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.getItemTemplate=function(){return"device"},d}(f),l=function(a){function d(a,b){this.device=b,this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.call(this,a,this.device),this.getAttribute("presence").value.subscribe(function(a){return function(){return a.updateClass()}}(this))}return b(d,a),d.prototype.getItemTemplate=function(){return"device"},d.prototype.afterRender=function(a){return d.__super__.afterRender.call(this,a),this.presenceEle=$(a).find(".attr-presence"),this.updateClass()},d.prototype.updateClass=function(){var a;if(a=this.getAttribute("presence").value(),null!=this.presenceEle)switch(a){case!0:this.presenceEle.addClass("value-present"),this.presenceEle.removeClass("value-absent");break;case!1:this.presenceEle.removeClass("value-present"),this.presenceEle.addClass("value-absent");break;default:this.presenceEle.removeClass("value-absent"),this.presenceEle.removeClass("value-present")}},d}(f),e=function(a){function d(){return this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.apply(this,arguments)}return b(d,a),d.prototype.getItemTemplate=function(){return"device"},d}(f),m=function(a){function c(a,b){this.device=b,c.__super__.constructor.call(this,a,this.device),this.getAttribute("position").value.subscribe(function(a){return function(b){return a._updateButtons(b)}}(this))}return b(c,a),c.prototype.onShutterDownClicked=function(){return"down"===this.getAttribute("position").value()?this._ajaxCall("stop"):this._ajaxCall("moveDown")},c.prototype.onShutterUpClicked=function(){return"up"===this.getAttribute("position").value()?this._ajaxCall("stop"):this._ajaxCall("moveUp")},c.prototype._ajaxCall=function(a){var b;return b=function(){switch(a){case"moveUp":return"moving up";case"moveDown":return"moving down";case"stop":return"stopping"}}(),this.downBtn.addClass("ui-state-disabled"),this.upBtn.addClass("ui-state-disabled"),pimatic.loading("shutter-"+this.deviceId,"show",{text:__(b)}),this.device.rest[a]({},{global:!1}).done(ajaxShowToast).always(function(a){return function(){return pimatic.loading("shutter-"+a.deviceId,"hide"),a.downBtn.removeClass("ui-state-disabled"),a.upBtn.removeClass("ui-state-disabled")}}(this)).fail(ajaxAlertFail)},c.prototype._updateButtons=function(a){if(null!=this.downBtn)switch(a){case"up":return this.downBtn.removeClass("ui-btn-active"),this.upBtn.addClass("ui-btn-active");case"down":return this.upBtn.removeClass("ui-btn-active"),this.downBtn.addClass("ui-btn-active");case"stopped":return this.upBtn.removeClass("ui-btn-active"),this.downBtn.removeClass("ui-btn-active")}},c.prototype.afterRender=function(a){var b;return c.__super__.afterRender.call(this,a),this.downBtn=$(a).find(".shutter-down"),this.upBtn=$(a).find(".shutter-up"),b=this.getAttribute("position").value(),null!=b?this._updateButtons(b):void 0},c}(f),i=function(a){function c(a,b){var d;this.device=b,c.__super__.constructor.call(this,a,this.device),this.type=this.getConfig("type"),this.inputValue=ko.observable(),this.inputAttr=this.getAttribute("input"),this.inputValue(this.inputAttr.value()),d=this.inputAttr.value(),this.inputAttr.value.subscribe(function(a){return function(b){return a.inputValue(b),d=b}}(this)),ko.computed(function(a){return function(){var b,c;if(c=a.inputValue(),d!==c){if("string"===a.type)return a.changeInputTo(c);if("number"===a.type&&null!=c&&null!=d&&parseFloat(d)!==parseFloat(c))return b=parseFloat(c),isNaN(c)||b!==b?(swal("Oops...",__(""+c+" is not a number."),"error"),void a.inputValue(d)):a.changeInputTo(b)}}}(this)).extend({rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}})}return b(c,a),c.prototype.changeInputTo=function(a){return this.device.rest.changeInputTo({value:a},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail).always(function(a){return function(){}}(this))},c.prototype.afterRender=function(a){var b,d,e;return c.__super__.afterRender.call(this,a),this.input=$(a).find("input"),"number"===this.type?(d=this.getConfig("min"),b=this.getConfig("max"),e=this.getConfig("step"),null!=d&&this.input.attr("min",d),null!=b&&this.input.attr("max",b),this.input.attr("step",e),this.input.spinbox().autosizeInput({space:30})):this.input.autosizeInput({space:5})},c}(f),d=function(a){function d(a,b){this.device=b,this.onButtonPress=c(this.onButtonPress,this),this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.call(this,a,this.device)}return b(d,a),d.prototype.getItemTemplate=function(){return"buttons"},d.prototype.onButtonPress=function(a){var b;return b=a.confirm?confirm(__("Do you really want to press %s?",a.text)):!0,b?this.device.rest.buttonPressed({buttonId:a.id},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail):void 0},d}(f),k=function(a){function d(a,b){this.device=b,this.togglePlay=c(this.togglePlay,this),this.sendPlayerAction=c(this.sendPlayerAction,this),this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.call(this,a,this.device),this.currentTitle=this.device.getAttribute("currentTitle").value,this.playButtonIcon=ko.computed(function(a){return function(){var b;return b=a.device.getAttribute("state").value,"play"===b()?"pause":"play"}}(this))}return b(d,a),d.prototype.getItemTemplate=function(){return"musicplayer"},d.prototype.sendPlayerAction=function(a){return this.device.rest[a]({}).done(ajaxShowToast).fail(ajaxAlertFail)},d.prototype.togglePlay=function(){var a,b;return b=this.device.getAttribute("state").value,a="play"===b()?"pause":"play",this.sendPlayerAction(a)},d}(f),p=function(a){function c(a,b){var d;this.device=b,c.__super__.constructor.call(this,a,this.device),this.inputValue=ko.observable(),this.stAttr=this.getAttribute("temperatureSetpoint"),this.inputValue(this.stAttr.value()),d=this.stAttr.value(),this.stAttr.value.subscribe(function(a){return function(b){return a.inputValue(b),d=b}}(this)),ko.computed(function(a){return function(){var b;return b=a.inputValue(),null!=b&&null!=d&&parseFloat(d)!==parseFloat(b)?a.changeTemperatureTo(parseFloat(b)):void 0}}(this)).extend({rateLimit:{timeout:1e3,method:"notifyWhenChangesStop"}}),this.synced=this.getAttribute("synced").value}return b(c,a),c.prototype.afterRender=function(a){var b,d;c.__super__.afterRender.call(this,a),this.autoButton=$(a).find("[name=autoButton]"),this.manuButton=$(a).find("[name=manuButton]"),this.boostButton=$(a).find("[name=boostButton]"),this.ecoButton=$(a).find("[name=ecoButton]"),this.comfyButton=$(a).find("[name=comfyButton]"),this.input=$(a).find(".spinbox input"),this.valvePosition=$(a).find(".valve-position-bar"),this.input.spinbox(),this.updateButtons(),this.updatePreTemperature(),this.updateValvePosition(),null!=(b=this.getAttribute("mode"))&&b.value.subscribe(function(a){return function(){return a.updateButtons()}}(this)),this.stAttr.value.subscribe(function(a){return function(){return a.updatePreTemperature()}}(this)),null!=(d=this.getAttribute("valve"))&&d.value.subscribe(function(a){return function(){return a.updateValvePosition()}}(this))},c.prototype.modeAuto=function(){return this.changeModeTo("auto")},c.prototype.modeManu=function(){return this.changeModeTo("manu")},c.prototype.modeBoost=function(){return this.changeModeTo("boost")},c.prototype.modeEco=function(){return this.changeTemperatureTo(""+this.device.config.ecoTemp)},c.prototype.modeComfy=function(){return this.changeTemperatureTo(""+this.device.config.comfyTemp)},c.prototype.modeVac=function(){return this.changeTemperatureTo(""+this.device.config.vacTemp)},c.prototype.setTemp=function(){return this.changeTemperatureTo(""+this.inputValue.value())},c.prototype.updateButtons=function(){var a,b;switch(a=null!=(b=this.getAttribute("mode"))?b.value():void 0){case"auto":this.manuButton.removeClass("ui-btn-active"),this.boostButton.removeClass("ui-btn-active"),this.autoButton.addClass("ui-btn-active");break;case"manu":this.manuButton.addClass("ui-btn-active"),this.boostButton.removeClass("ui-btn-active"),this.autoButton.removeClass("ui-btn-active");break;case"boost":this.manuButton.removeClass("ui-btn-active"),this.boostButton.addClass("ui-btn-active"),this.ecoButton.removeClass("ui-btn-active"),this.comfyButton.removeClass("ui-btn-active"),this.autoButton.removeClass("ui-btn-active")}},c.prototype.updatePreTemperature=function(){parseFloat(this.stAttr.value())===parseFloat(""+this.device.config.ecoTemp)?(this.boostButton.removeClass("ui-btn-active"),this.ecoButton.addClass("ui-btn-active"),this.comfyButton.removeClass("ui-btn-active")):parseFloat(this.stAttr.value())===parseFloat(""+this.device.config.comfyTemp)?(this.boostButton.removeClass("ui-btn-active"),this.ecoButton.removeClass("ui-btn-active"),this.comfyButton.addClass("ui-btn-active")):(this.ecoButton.removeClass("ui-btn-active"),this.comfyButton.removeClass("ui-btn-active"))},c.prototype.updateValvePosition=function(){var a,b;return a=null!=(b=this.getAttribute("valve"))?b.value():void 0,null!=a?(this.valvePosition.css("height",""+a+"%"),this.valvePosition.parent().css("display","")):this.valvePosition.parent().css("display","none")},c.prototype.changeModeTo=function(a){return this.device.rest.changeModeTo({mode:a},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail)},c.prototype.changeTemperatureTo=function(a){return this.input.spinbox("disable"),this.device.rest.changeTemperatureTo({temperatureSetpoint:a},{global:!1}).done(ajaxShowToast).fail(ajaxAlertFail).always(function(a){return function(){return a.input.spinbox("enable")}}(this))},c}(f),q=function(a){function d(a,b){this.device=b,this.toggleRunning=c(this.toggleRunning,this),this.sendTimerAction=c(this.sendTimerAction,this),this.getItemTemplate=c(this.getItemTemplate,this),d.__super__.constructor.call(this,a,this.device),this.startButtonIcon=ko.computed(function(a){return function(){var b;return b=a.device.getAttribute("running").value,b()?"stop":"play"}}(this))}return b(d,a),d.prototype.getItemTemplate=function(){return"timer"},d.prototype.sendTimerAction=function(a){return this.device.rest[a]({}).done(ajaxShowToast).fail(ajaxAlertFail)},d.prototype.toggleRunning=function(){var a,b;return b=this.device.getAttribute("running").value,a=b()?"stopTimer":"startTimer",this.sendTimerAction(a)},d}(f),pimatic.Item=j,pimatic.HeaderItem=h,pimatic.ButtonsItem=d,pimatic.DeviceItem=f,pimatic.SwitchItem=n,pimatic.DimmerItem=g,pimatic.TemperatureItem=o,pimatic.PresenceItem=l,pimatic.ShutterItem=m,pimatic.ContactItem=e,pimatic.MuscicplayerItem=k,pimatic.ThermostatItem=p,pimatic.TimerItem=q,pimatic.InputItem=i,pimatic.templateClasses={"null":pimatic.DeviceItem,header:pimatic.HeaderItem,buttons:pimatic.ButtonsItem,variable:pimatic.VariableItem,device:pimatic.DeviceItem,"switch":pimatic.SwitchItem,dimmer:pimatic.DimmerItem,temperature:pimatic.TemperatureItem,presence:pimatic.PresenceItem,contact:pimatic.ContactItem,shutter:pimatic.ShutterItem,musicplayer:pimatic.MuscicplayerItem,thermostat:pimatic.ThermostatItem,timer:pimatic.TimerItem,input:pimatic.InputItem},$(document).trigger("templateinit",[]),$(document).trigger("templateready",[]))})}).call(this);